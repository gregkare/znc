// Managed by Chef
//
// See http://en.znc.in/wiki/Configuration

// Global settings
AnonIPLimit    = <%= node['znc']['anon_ip_limit'] %>
ConnectDelay   = <%= node['znc']['connect_delay'] %>
MaxBufferSize  = <%= node['znc']['max_buffer_size'] %>
<% if node['znc']['motd'] %>
Motd           = <%= node['znc']['motd'] %>
<% end -%>
ServerThrottle = <%= node['znc']['server_throttle'] %>
Skin           = <%= node['znc']['skin'] %>
SSLCertFile    = <%= node['znc']['data_dir'] %>/znc.pem
StatusPrefix   = <%= node['znc']['status_prefix'] %>

// Global modules loaded on startup
<% node['znc']['modules'].each do |mod, params| -%>
LoadModule = <%= "#{mod} #{params}".strip %>
<% end -%>

// Ports to listen on
<% node['znc']['listeners'].each_with_index do |listener, index| -%>
<Listener <%= listener['name'] || "listener#{index}" %>>
  AllowIRC = <%= listener.fetch('allow_irc', true) %>
  AllowWeb = <%= listener.fetch('allow_web', true) %>
  IPv4     = <%= listener.fetch('ipv4', true) %>
  IPv6     = <%= listener.fetch('ipv6', true) %>
  Port     = <%= listener['port'] %>
  SSL      = <%= listener.fetch('ssl', true) %>
</Listener>
<% end -%>

<% @users.each do |u| %>
<User <%= u['znc']['nick'] || u['id']  %>>
	Pass = <%= u['znc']['pass'] %>
	Nick = <%= u['znc']['nick'] || u['id'] %>
	AltNick = <%= u['znc']['alt_nick'] || "#{u['id']}_" %>
	Ident = <%= u['znc']['ident'] %>
	RealName = <%= u['znc']['real_name'] || u['comment'] %>
	QuitMsg = <%= u['znc']['quit_msg'] || 'Goodbye' %>
	ChanModes = <%= u['znc']['chan_modes'] || '+stn' %>
	Buffer = <%= u['znc']['buffer'] || 50 %>
	KeepBuffer = <%= u['znc']['keep_buffer'] || false %>
	MultiClients = true
	BounceDCCs = true
	DenyLoadMod = false
	Admin = true
	DenySetBindHost = false
	DCCLookupMethod = default
	TimestampFormat = [%H:%M:%S]
	AppendTimestamp = false
	PrependTimestamp = true
	TimezoneOffset = <%= u['znc']['timezone_offset'] || '0.00' %>
	JoinTries = 10
	MaxJoins = 5
	IRCConnectEnabled = true

	Allow = *

  <% Array(u['znc']['modules']).each do |mod,params| -%>
	LoadModule = <%= "#{mod} #{params}".strip  %>
  <% end -%>

	Server = <%= u['znc']['server'] %>
<% Array(u['znc']['channels']).each do |chan,options| -%>

	<Chan <%= chan %>>
	</Chan>
<% end -%>
</User>
<% end -%>
